@using melodika.Models
@using System.Linq
@{
    ViewData["Title"] = "Canciones";
}

<section class="Canciones-populares">
    <div>
        <h1>Canciones</h1>
        <p>No encontr√°s tu canci√≥n? busca la tuya!</p>
        <div>
            <input type="text" placeholder="" />
            <button type="button">üîç</button>
        </div>
    </div>

    <section>
        <h2>Canciones populares:</h2>
        <div class="canciones-grid">
            @foreach (Cancion cancion in ViewBag.canciones)
            {
               
                string urlDestino = Url.Action("CancionesPopularesAdentroHard", "Home");

                
                <a href="javascript:void(0);" 
                   class="song-card-link"
                   onclick="validarInstrumento(@cancion.IdInstrumento, '@urlDestino', '@cancion.Titulo')">
                   
                    <div class="song-card">
                        <img src="@(string.IsNullOrEmpty(cancion.Portada) ? "/imagenes/default.jpg" : cancion.Portada)" alt="Foto Cancion" />
                        
                        <div class="song-info">
                            <h3>@cancion.Titulo - @cancion.Autor</h3>
                            <div class="song-meta">
                                <span>@cancion.Dificultad</span>
                                <div class="canciones-estrellas">
                                    @switch(cancion.Valoracion){
                                        case 0:<span>‚≠ê‚òÜ‚òÜ</span> break;
                                        case 1:<span>‚≠ê‚≠ê‚òÜ</span> break;
                                        case 2:<span>‚≠ê‚≠ê‚≠ê</span> break;
                                        default: <span>‚òÜ‚òÜ‚òÜ</span> break;
                                    }
                                </div>
                            </div>
                        </div>
                    </div>
                </a>
            }
        </div>
    </section>
</section>

<div class="modal fade" id="modalAdvertencia" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header bg-warning">
        <h5 class="modal-title text-dark fw-bold">‚ö†Ô∏è Instrumento diferente</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body text-center">
        <p class="mb-3">La canci√≥n <strong id="nombreCancionModal"></strong> es para otro instrumento.</p>
        <p class="text-muted small">Pod√©s entrar igual, pero la tablatura no coincidir√° con lo que toc√°s.</p>
      </div>
      <div class="modal-footer justify-content-center">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
        <a href="#" id="btnSeguirIgual" class="btn btn-primary">Seguir igual</a>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="modalSinInstrumento" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header bg-primary text-white">
        <h5 class="modal-title fw-bold">üé∏ ¬°Falta poco!</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body text-center py-4">
        <p class="fs-5">Para ver las canciones, primero necesit√°s elegir qu√© instrumento toc√°s.</p>
        <p class="text-muted small">Esto nos ayuda a mostrarte las tablaturas correctas.</p>
      </div>
      <div class="modal-footer justify-content-center">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
        <a href="@Url.Action("SeleccionarInstrumento", "Account")" class="btn btn-primary px-4">Elegir instrumento</a>
      </div>
    </div>
  </div>
</div>

<script>

   var idInstrumentoUsuario = @(ViewBag.instrumentoUsuario ?? 0);

   function validarInstrumento(idInstrumentoCancion, urlDestino, titulo) {
       
       // 1. Caso √âxito
       if (idInstrumentoUsuario == idInstrumentoCancion && idInstrumentoUsuario != 0) {
           window.location.href = urlDestino; 
       } 
       
       // 2. Caso Sin Instrumento (Abre el NUEVO Modal)
       else if(idInstrumentoUsuario == 0){
           var myModal = new bootstrap.Modal(document.getElementById('modalSinInstrumento'));
           myModal.show();
       }
       
       // 3. Caso Instrumento Diferente (Abre el Modal Advertencia)
       else {
           document.getElementById("nombreCancionModal").innerText = titulo;
           document.getElementById("btnSeguirIgual").href = urlDestino;
           
           var myModal = new bootstrap.Modal(document.getElementById('modalAdvertencia'));
           myModal.show();
       }
   }
</script>